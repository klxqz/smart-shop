function showMsg(a,t){void 0===t&&(t="success"),noty({text:a,type:t,dismissQueue:!0,layout:"bottomLeft",closeWith:["click"],maxVisible:5,theme:"relax",timeout:5e3,animation:{open:"animated bounceInLeft",close:"animated bounceOutLeft",easing:"swing",speed:500}})}function initCompare(){$("#content").on("click",".compare-add",function(){var a=$.cookie("shop_compare");a=a?a.split(","):[];var t=$(this).closest(".product-thumb").find(".ajax_product_info"),i=$.inArray($(this).data("id")+"",a);if(-1==i){a.push($(this).data("id"));var e=compare_url.replace(/compare\/.*$/,"compare/"+a.join(",")+"/");showMsg('<i class="fa fa-check-circle"></i> Товар <a href="'+t.data("url")+'">'+t.data("name")+'</a> успешно добавлен в <a href="'+e+'">Список сравнения</a>')}else{a.splice(i,1);var e=compare_url.replace(/compare\/.*$/,"compare/"+a.join(",")+"/");showMsg('<i class="fa fa-check-circle"></i> Товар <a href="'+t.data("url")+'">'+t.data("name")+'</a> удален из <a href="'+e+'">Списка сравнения</a>',"warning")}return $(".compare-total").attr("href",e),$(".compare-total .count").text(a.length),a.length>0?$.cookie("shop_compare",a.join(","),{expires:30,path:"/"}):$.cookie("shop_compare",null,{expires:30,path:"/"}),!1})}function initWishlist(){$("#content").on("click",".wishlist-add",function(){var a=$.cookie("shop_wishlist");a=a?a.split(","):[];var t=$(this).closest(".product-thumb").find(".ajax_product_info"),i=$.inArray($(this).data("id")+"",a);return-1==i?(a.push($(this).data("id")),showMsg('<i class="fa fa-check-circle"></i> Товар <a href="'+t.data("url")+'">'+t.data("name")+'</a> успешно добавлен в <a href="'+wishlist_url+'">Избранное</a>')):(a.splice(i,1),showMsg('<i class="fa fa-check-circle"></i> Товар <a href="'+t.data("url")+'">'+t.data("name")+'</a> удален из <a href="'+wishlist_url+'">Избранного</a>',"warning")),$(".wishlist-total .count").text(a.length),a.length>0?$.cookie("shop_wishlist",a.join(","),{expires:30,path:"/"}):$.cookie("shop_wishlist",null,{expires:30,path:"/"}),!1})}function initRangeSlider(){$(".price_slider").each(function(){if(!$(this).find(".slider-range").length){var a=$(this),t=$('<div class="slider-range"></div>').appendTo(a),i=$('input[name="'+$(this).data("name-min")+'"]'),e=$('input[name="'+$(this).data("name-max")+'"]');t.slider({range:!0,min:a.data("min"),max:a.data("max"),values:[i.val()?i.val():a.data("min"),e.val()?e.val():a.data("max")],slide:function(a,t){var o=t.values[0]==$(this).slider("option","min")?"":t.values[0];i.val(o),o=t.values[1]==$(this).slider("option","max")?"":t.values[1],e.val(o)},stop:function(a,t){i.change()}}),i.add(e).change(function(){var a=""===i.val()?t.slider("option","min"):parseFloat(i.val()),o=""===e.val()?t.slider("option","max"):parseFloat(e.val());o>=a&&t.slider("option","values",[a,o])})}})}$(document).ready(function(){if($(document).on("click",".quick-view",function(){var a=$("#dialog"),t=$('<div class="product-info"></div>');return t.html('<i class="icon32 loading"><i>'),a.find(".content").html(t),t.load($(this).attr("href")+"?cart=1&quick_view=1",function(){t.prepend('<a href="#" class="dialog-close"><i class="fa fa-times" aria-hidden="true"></i></a>')}),a.show(),$("html").addClass("dialog-open"),!1}),$(document).on("click",".product-image-next",function(){var a=$(this).closest(".image").find("img"),t=$(this).closest(".product-image-buttons").data("images"),i=t.indexOf(a.attr("src"));return i<t.length-1?i++:i=0,a.hide(),a.after('<i class="icon16 loading"><i>'),a.attr("src",t[i]),a.one("load",function(){$(this).next(".loading").remove(),$(this).show()}),!1}),$(document).on("click",".product-image-prev",function(){var a=$(this).closest(".image").find("img"),t=$(this).closest(".product-image-buttons").data("images"),i=t.indexOf(a.attr("src"));return i>0?i--:i=t.length-1,a.attr("src",t[i]),!1}),$("#clear-wishlist").click(function(){return $.cookie("shop_wishlist","",{expires:0,path:"/"}),location.reload(),!1}),$("#currency a").click(function(){var a=location.href;return a+=-1==a.indexOf("?")?"?":"&",location.href=a+"currency="+$(this).data("code"),!1}),$(".option_box .option_name").click(function(){var a=$.cookie("shop_filter_collapsible");a=a?a.split(","):[];var t=$.inArray($(this).data("filter")+"",a);$(this).hasClass("hided")&&-1!=t?a.splice(t,1):$(this).hasClass("hided")||-1!=t||a.push($(this).data("filter")),a.length>0?$.cookie("shop_filter_collapsible",a.join(","),{expires:30,path:"/"}):$.cookie("shop_filter_collapsible",null,{expires:30,path:"/"}),$(this).siblings(".collapsible").toggle(),$(this).toggleClass("hided")}),$(".filters.ajax input").change(function(){var a=$(".filters.ajax"),t="?"+a.serialize();$(".products-category .product-thumb").append('<div class="loadmask"></div>'),$.get(t+"&_=_",function(a){var i=$("<div></div>").html(a);$(".products-category").html(i.find(".products-category").html()),$(".products-category img[data-original]").lazyload({effect:"fadeIn"}),$(".pagination-block").html(i.find(".pagination-block").html()),"list"==localStorage.getItem("display")?$("#list-view").trigger("click"):$("#grid-view").trigger("click"),history.pushState&&void 0!==history.state&&window.history.pushState({},"",t)})}),initCompare(),initWishlist(),$("#input-sort").change(function(){location.assign($(this).val())}),$("#input-limit").change(function(){$(this).val()?$.cookie("products_per_page",$(this).val(),{expires:30,path:"/"}):$.cookie("products_per_page","",{expires:0,path:"/"}),location.reload()}),$("#content").on("submit","form.addtocart",function(){var a=$(this),t=$('<div class="button-overlay"><i class="icon16 loading"></i></div>');if(a.data("url")){$(this).find("button").append(t);var i=$("#dialog"),e=$('<div class="product-info"></div>');return e.html('<i class="icon32 loading"><i>'),i.find(".content").html(e),e.load(a.data("url"),function(){t.remove(),e.prepend('<a href="#" class="dialog-close"><i class="fa fa-times" aria-hidden="true"></i></a>')}),i.show(),$("html").addClass("dialog-open"),!1}return $(this).find("button").append(t),$.post(a.attr("action")+"?html=1",a.serialize(),function(i){if(t.remove(),"ok"==i.status){var e=$("#cart-total"),o=a.closest(".product-thumb"),n=o.find(".ajax_product_info");showMsg('<i class="fa fa-check-circle"></i> Товар <a href="'+n.data("url")+'">'+n.data("name")+'</a> успешно добавлен в <a href="'+cart_url+'">корзину</a>'),$("#cart").addClass("open");var l=$("<div></div>").append(o.html()),s=e.offset().top;$(window).scrollTop()>e.offset().top&&(s=$(window).scrollTop()),l.css({"z-index":10,top:o.offset().top,left:o.offset().left,width:o.width()+"px",height:o.height()+"px",position:"absolute",overflow:"hidden"}).appendTo("body").animate({top:s,left:e.offset().left,width:0,height:0,opacity:.5},500,function(){$(this).remove(),e.html(i.data.total);var a=$("#cart .cart-items tr[data-id="+i.data.item_id+"]"),t=1;if(a.length)t=parseInt(a.find(".quantity").text())+t,a.find(".quantity").text(t);else{var o={url:n.data("url"),name:n.data("name"),img:n.data("img"),price:n.data("price"),quantity:t,id:i.data.item_id};$("#cart_item_tmpl").tmpl(o).appendTo("#cart .cart-items table tbody"),$("#cart .cart-items").show(),$("#cart .cart-buttons").show(),$("#cart .cart-empty").hide()}$("table.cart").length&&location.reload()}),i.data.error&&alert(i.data.error)}else"fail"==i.status&&alert(i.errors)},"json"),!1}),$.fn.lazyLoad){var a=$(".lazyloading-paging");if(!a.length)return;var t=a.find("li.selected");if("1"!=t.children("a").text())return;a.hide();var i=a.data("loading-str")||"Loading...",e=$(window);e.lazyLoad("stop");var o=t.next();o.length&&e.lazyLoad({container:"#content",load:function(){e.lazyLoad("sleep");var a=$(".lazyloading-paging").hide(),t=a.find("li.selected"),o=t.next(),n=o.find("a").attr("href");if(!n)return void e.lazyLoad("stop");var l=$(".products-category"),s=a.parent().find(".loading").parent();s.length||(s=$('<div><i class="icon16 loading"></i>'+i+"</div>").insertBefore(a)),s.show(),$.get(n,function(t){var i=$("<div></div>").html(t);$.Retina&&i.find(".product-list img").retina(),img_lazyload&&i.find(".product-list img[data-original]").lazyload({effect:"fadeIn"}),l.append(i.find(".products-category").children()),"list"==localStorage.getItem("display")?$("#list-view").trigger("click"):$("#grid-view").trigger("click");var o=i.find(".lazyloading-paging").hide();a.replaceWith(o),a=o;var n=a.find("li.selected"),r=n.next();r.length?e.lazyLoad("wake"):e.lazyLoad("stop"),s.hide(),i.remove()})}})}});