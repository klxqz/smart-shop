function showMsg(t){$(".alert").length&&$(".alert .close").trigger("click"),$('<div class="alert alert-success">'+t+'<button data-dismiss="alert" class="close" type="button">×</button></div>').prependTo("#container > .container:first-child"),$("html, body").animate({scrollTop:0},"slow")}function initCompare(){$("#content").on("click",".compare-add",function(){var t=$.cookie("shop_compare");t=t?t.split(","):[];var i=$.inArray($(this).data("id")+"",t);-1==i&&t.push($(this).data("id"));var a=compare_url.replace(/compare\/.*$/,"compare/"+t.join(",")+"/");$(".compare-total").attr("href",a),$(".compare-total .count").text(t.length);var e=$(this).closest(".product-thumb").find(".ajax_product_info");return showMsg('<i class="fa fa-check-circle"></i> Товар <a href="'+e.data("url")+'">'+e.data("name")+'</a> успешно добавлен в <a href="'+a+'">Список сравнения</a>'),t.length>0?$.cookie("shop_compare",t.join(","),{expires:30,path:"/"}):$.cookie("shop_compare",null,{expires:30,path:"/"}),!1})}function initWishlist(){$("#content").on("click",".wishlist-add",function(){var t=$.cookie("shop_wishlist");t=t?t.split(","):[];var i=$.inArray($(this).data("id")+"",t);-1==i&&t.push($(this).data("id")),$(".wishlist-total .count").text(t.length);var a=$(this).closest(".product-thumb").find(".ajax_product_info");return showMsg('<i class="fa fa-check-circle"></i> Товар <a href="'+a.data("url")+'">'+a.data("name")+'</a> успешно добавлен в <a href="'+wishlist_url+'">Избранное</a>'),t.length>0?$.cookie("shop_wishlist",t.join(","),{expires:30,path:"/"}):$.cookie("shop_wishlist",null,{expires:30,path:"/"}),!1})}$(document).ready(function(){if($(document).on("click",".quick-view",function(){var t=$("#dialog"),i=$('<div class="product-info"></div>');return i.html('<i class="icon32 loading"><i>'),t.find(".content").html(i),i.load($(this).attr("href")+"?cart=1&quick_view=1",function(){i.prepend('<a href="#" class="dialog-close">&times;</a>')}),t.show(),$("html").addClass("dialog-open"),!1}),$(document).on("click",".product-image-next",function(){var t=$(this).closest(".image").find("img"),i=$(this).closest(".product-image-buttons").data("images"),a=i.indexOf(t.attr("src"));return a<i.length-1?a++:a=0,t.hide(),t.after('<i class="icon16 loading"><i>'),t.attr("src",i[a]),t.one("load",function(){$(this).next(".loading").remove(),$(this).show()}),!1}),$(document).on("click",".product-image-prev",function(){var t=$(this).closest(".image").find("img"),i=$(this).closest(".product-image-buttons").data("images"),a=i.indexOf(t.attr("src"));return a>0?a--:a=i.length-1,t.attr("src",i[a]),!1}),$("#clear-wishlist").click(function(){return $.cookie("shop_wishlist","",{expires:0,path:"/"}),location.reload(),!1}),$("#currency a").click(function(){var t=location.href;return t+=-1==t.indexOf("?")?"?":"&",location.href=t+"currency="+$(this).data("code"),!1}),$(".option_box .option_name").click(function(){var t=$.cookie("shop_filter_collapsible");t=t?t.split(","):[];var i=$.inArray($(this).data("filter")+"",t);$(this).hasClass("hided")&&-1!=i?t.splice(i,1):$(this).hasClass("hided")||-1!=i||t.push($(this).data("filter")),t.length>0?$.cookie("shop_filter_collapsible",t.join(","),{expires:30,path:"/"}):$.cookie("shop_filter_collapsible",null,{expires:30,path:"/"}),$(this).siblings(".collapsible").toggle(),$(this).toggleClass("hided")}),$(".filters.ajax input").change(function(){var t=$(".filters.ajax"),i="?"+t.serialize();$(".products-category .product-thumb").append('<div class="loadmask"></div>'),$.get(i+"&_=_",function(t){var a=$("<div></div>").html(t);$(".products-category").html(a.find(".products-category").html()),"list"==localStorage.getItem("display")?$("#list-view").trigger("click"):$("#grid-view").trigger("click"),history.pushState&&void 0!==history.state&&window.history.pushState({},"",i)})}),$(".price_slider").each(function(){if(!$(this).find(".slider-range").length){var t=$(this),i=$('<div class="slider-range"></div>').appendTo(t),a=$('input[name="'+$(this).data("name-min")+'"]'),e=$('input[name="'+$(this).data("name-max")+'"]');i.slider({range:!0,min:t.data("min"),max:t.data("max"),values:[a.val()?a.val():t.data("min"),e.val()?e.val():t.data("max")],slide:function(t,i){var o=i.values[0]==$(this).slider("option","min")?"":i.values[0];a.val(o),o=i.values[1]==$(this).slider("option","max")?"":i.values[1],e.val(o)},stop:function(t,i){a.change()}}),a.add(e).change(function(){var t=""===a.val()?i.slider("option","min"):parseFloat(a.val()),o=""===e.val()?i.slider("option","max"):parseFloat(e.val());o>=t&&i.slider("option","values",[t,o])})}}),initCompare(),initWishlist(),$("#input-sort").change(function(){location.assign($(this).val())}),$("#input-limit").change(function(){$(this).val()?$.cookie("products_per_page",$(this).val(),{expires:30,path:"/"}):$.cookie("products_per_page","",{expires:0,path:"/"}),location.reload()}),$(document).keyup(function(t){27==t.keyCode&&$(".dialog:visible").hide().find(".content").empty()}),$("#content").on("submit","form.addtocart",function(){var t=$(this),i=$('<div class="button-overlay"><i class="icon16 loading"></i></div>');if(t.data("url")){$(this).find("button").append(i);var a=$("#dialog"),e=$('<div class="product-info"></div>');return e.html('<i class="icon32 loading"><i>'),a.find(".content").html(e),e.load(t.data("url"),function(){i.remove(),e.prepend('<a href="#" class="dialog-close">&times;</a>')}),a.show(),$("html").addClass("dialog-open"),!1}return $(this).find("button").append(i),$.post(t.attr("action")+"?html=1",t.serialize(),function(a){if(i.remove(),"ok"==a.status){var e=$("#cart-total");if($("table.cart").length)$(".content").parent().load(location.href,function(){e.html(a.data.total)});else{var o=t.closest(".product-thumb"),n=$("<div></div>").append(o.html()),l=e.offset().top;$(window).scrollTop()>e.offset().top&&(l=$(window).scrollTop()),n.css({"z-index":10,top:o.offset().top,left:o.offset().left,width:o.width()+"px",height:o.height()+"px",position:"absolute",overflow:"hidden"}).appendTo("body").animate({top:l,left:e.offset().left,width:0,height:0,opacity:.5},500,function(){$(this).remove(),e.html(a.data.total);var t=$("#cart .cart-items tr[data-id="+a.data.item_id+"]"),i=1;if(t.length)i=parseInt(t.find(".quantity").text())+i,t.find(".quantity").text(i);else{var n=o.find(".ajax_product_info"),l={url:n.data("url"),name:n.data("name"),img:n.data("img"),price:n.data("price"),quantity:i,id:a.data.item_id};$("#cart_item_tmpl").tmpl(l).appendTo("#cart .cart-items table tbody"),$("#cart .cart-items").show(),$("#cart .cart-buttons").show(),$("#cart .cart-empty").hide()}})}a.data.error&&alert(a.data.error)}else"fail"==a.status&&alert(a.errors)},"json"),!1}),$.fn.lazyLoad){var t=$(".lazyloading-paging");if(!t.length)return;var i=t.find("li.selected");if("1"!=i.children("a").text())return;t.hide();var a=t.data("loading-str")||"Loading...",e=$(window);e.lazyLoad("stop");var o=i.next();o.length&&e.lazyLoad({container:"#content",load:function(){e.lazyLoad("sleep");var t=$(".lazyloading-paging").hide(),i=t.find("li.selected"),o=i.next(),n=o.find("a").attr("href");if(!n)return void e.lazyLoad("stop");var l=$(".products-category"),s=t.parent().find(".loading").parent();s.length||(s=$('<div><i class="icon16 loading"></i>'+a+"</div>").insertBefore(t)),s.show(),$.get(n,function(i){var a=$("<div></div>").html(i);$.Retina&&a.find("#product-list .product-list img").retina(),l.append(a.find(".products-category").children()),"list"==localStorage.getItem("display")?$("#list-view").trigger("click"):$("#grid-view").trigger("click");var o=a.find(".lazyloading-paging").hide();t.replaceWith(o),t=o;var n=t.find("li.selected"),r=n.next();r.length?e.lazyLoad("wake"):e.lazyLoad("stop"),s.hide(),a.remove()})}})}});