$(function(){function t(t){$(".cart-total").html(t.total),$("#cart-total").html(t.total),t.discount_numeric&&$(".cart-discount").closest("tr").show(),$(".cart-discount").html("&minus; "+t.discount),t.add_affiliate_bonus?$(".affiliate").show().html(t.add_affiliate_bonus):$(".affiliate").hide()}$(".services input:checkbox").click(function(){var t=$('select[name="service_variant['+$(this).closest("tr").data("id")+"]["+$(this).val()+']"]');t.length&&($(this).is(":checked")?t.removeAttr("disabled"):t.attr("disabled","disabled"))}),$(".cart a.delete").click(function(){var a=$(this).closest("tr");return $.post("delete/",{html:1,id:a.data("id")},function(i){0==i.data.count&&location.reload(),a.remove(),t(i.data)},"json"),!1}),$(".cart input.qty").change(function(){var a=$(this);if(a.val()>0){var i=a.closest("tr");a.val()&&$.post("save/",{html:1,id:i.data("id"),quantity:a.val()},function(e){i.find(".item-total").html(e.data.item_total),e.data.q&&a.val(e.data.q),e.data.error?alert(e.data.error):a.removeClass("error"),t(e.data)},"json")}else a.val(1)}),$(".cart .services input:checkbox").change(function(){var a=$(this).closest("div"),i=$(this).closest("tr");if($(this).is(":checked")){var e=$(this).closest("tr").data("id"),s={html:1,parent_id:e,service_id:$(this).val()},l=$('select[name="service_variant['+e+"]["+$(this).val()+']"]');l.length&&(s.service_variant_id=l.val()),$.post("add/",s,function(e){a.data("id",e.data.id),i.find(".item-total").html(e.data.item_total),t(e.data)},"json")}else $.post("delete/",{html:1,id:a.data("id")},function(e){a.data("id",null),i.find(".item-total").html(e.data.item_total),t(e.data)},"json")}),$(".cart .services select").change(function(){var a=$(this).closest("tr");$.post("save/",{html:1,id:$(this).closest("div").data("id"),service_variant_id:$(this).val()},function(i){a.find(".item-total").html(i.data.item_total),t(i.data)},"json")}),$("#cancel-affiliate").click(function(){return $(this).closest("form").append('<input type="hidden" name="use_affiliate" value="0">').submit(),!1})});